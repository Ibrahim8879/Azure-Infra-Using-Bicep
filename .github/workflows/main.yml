name: 'Bicep Unit Tests'

on:
  pull_request:
    branches:
      - main
    paths:
      - 'src/iac/az-controllers/azure-services/client/**'
      - 'src/iac/az-controllers/azure-services/shared/**'

env:
  LOCATION: "southcentralus"
  
permissions:
  id-token: write
  contents: read
  security-events: write
  actions: read

jobs:
  shared-job:
    name: 'Shared Tests'
    runs-on: ubuntu-latest
    if: contains(github.event.pull_request.labels.*.name, 'shared')
    steps:
      - uses: actions/checkout@v3
      - run: echo "Running SHARED tests in $LOCATION..."

  client-job:
    name: 'Client Tests'
    runs-on: ubuntu-latest
    needs: shared-job   # ensures shared runs first if both exist
    if: contains(github.event.pull_request.labels.*.name, 'client')
    steps:
      - uses: actions/checkout@v3
      - run: echo "Running CLIENT tests in $LOCATION..."
